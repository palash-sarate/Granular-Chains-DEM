# Flexible granular chain simulation in LAMMPS

units       si
atom_style hybrid sphere molecular
# sphere
# atom-ID atom-type diameter density x y z
# bond
# atom-ID molecule-ID atom-type x y z
# hybrid sphere molecular
# atom-ID atom-type x y z molecule-ID diameter density
# atom_modify	map array
boundary    p p p

special_bonds fene

# Read the atom and bond data from the data file.
read_data test_format.data #chain.data

# Ensure spherical properties are consistent (overrides data if needed)
set type 1 diameter 0.001
set type 1 density 1180.0
velocity all set 0.0 0.0 0.0

# Optional: ensure directory exists for output
shell mkdir -p post

# Apply gravity
fix grav all gravity 9.81 vector 0 0 -1

pair_style gran model hertz tangential history
fix prop1 all property/global youngsModulus peratomtype 5.0e6
fix prop2 all property/global poissonsRatio peratomtype 0.45
fix prop3 all property/global coefficientRestitution peratomtypepair 1 0.3
fix prop4 all property/global coefficientFriction peratomtypepair 1 0.5
pair_coeff * *

# Define the bond style as Finite Extensible Nonlinear Elastic (FENE).
# This provides a stiff restoring force that prevents the bond from stretching
# beyond a defined maximum distance (R0). There is a repulsive force at
# very close ranges, but no force in the middle, allowing beads to move freely
# within the bond's range.
# The parameters for bond_coeff are K (bond stiffness) and R0 (max bond length).
# K = 100000 (very stiff, approximates an infinite well)
# R0 = 0.001 (1mm, your required maximum separation)
bond_style fene
bond_coeff 1 100000 0.001 0.001 0.001 # type K R0 epsilon sigma

# Define the angle style as Harmonic. This will act as our angular infinite well.
# The potential is given by E=K(θ−θ0)^2 where θ0 is the equilibrium angle.
# We will set θ0 to your desired limit of 38 degrees.
angle_style harmonic
angle_coeff 1 100000 38.0 # type K_angle theta0

# Use the standard NVE integrator for non-rigid bodies.
fix integr all nve

# Set up neighbor list parameters
neighbor 0.005 bin
neigh_modify delay 0

# Set a timestep for the simulation. A small timestep is required for this stiff bond.
timestep 0.000001

# === 4. OUTPUTS & RUN ===
# Output thermodynamic data every 1000 timesteps.
thermo 1000
thermo_style custom step pe ke etotal temp press

# Output a dump file of the atom coordinates for visualization (e.g., in ParaView)
dump 1 all custom/vtk 100 post/chain_*.vtk id type x y z vx vy vz fx fy fz
dump_modify 1 sort id

# Run the simulation for 100000 timesteps.
run 100000
