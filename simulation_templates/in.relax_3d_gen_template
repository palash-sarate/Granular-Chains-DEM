# 3D Relaxation of granular chain using Langevin dynamics

units       si
atom_style hybrid sphere angle
boundary    f f f

special_bonds lj/coul 1.0 1.0 1.0

# Variables passed from runner:
# outdir, data_file, seed, run_steps, dt, temperature

# Default temperature if not set (approx 1e12 K for macroscopic particles)
if "${temperature} == 0" then "variable temperature equal 1e12"

read_data ${data_file}

# Initialize velocities
velocity all create ${temperature} ${seed} dist gaussian

# --- FORCE FIELD (Same as chain_flop) ---
variable r_max equal 0.0005
variable theta_lim equal 2.4435
variable knt2   equal 1.0e6
variable ktheta equal 1.0e6
variable w   equal 1.0e-4
variable delta equal 1.0e-4

comm_modify vel yes

# Granular pair style
pair_style  granular
pair_coeff  1 1 hooke 1e6 50.0 & 
            tangential linear_history 1.0e6 1.0 0.3 & 
            rolling sds 1.0e6 5000 0.3 &
            twisting marshall

# Bond style
bond_style lepton no_offset
bond_coeff 1 0.003 "0.5 * knt2 * (r - r_max)^2 * 0.5 * (1 + tanh((r - r_max)/w)); knt2=v_knt2; r_max=v_r_max; w=v_w"

# Angle style
angle_style lepton no_offset
angle_coeff 1 0 "0.5 * ktheta * (theta - t_lim)^2 * 0.5 * (1 + tanh((t_lim - theta)/w_a)); ktheta=v_ktheta; t_lim=v_theta_lim; w_a=v_delta"

# --- INTEGRATION ---
# NVE integration for movement
fix 1 all nve/sphere

# Langevin thermostat for randomization (Brownian motion)
# temp start, temp stop, damp parameter (time units)
# damp should be around 100-1000 timesteps
variable damp equal 1000*${dt}
fix 2 all langevin ${temperature} ${temperature} ${damp} ${seed} omega yes

neighbor 0.004 bin
neigh_modify delay 0 every 1 check yes

timestep ${dt}

thermo 1000
thermo_style custom step pe ke etotal temp

run ${run_steps}

# Write the final state
write_data ${outdir}/relaxed_chain.data
